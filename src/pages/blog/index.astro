---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeading from '../../components/SectionHeading.astro';
import { getCollection } from 'astro:content';

// Pobierz wszystkie posty, posortowane od najnowszych
const allPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.PROD ? data.draft !== true : true;
});

const posts = allPosts.sort((a, b) => 
  b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

// Wyr√≥≈ºnione posty
const featuredPosts = posts.filter(post => post.data.featured).slice(0, 3);

// Kategorie z licznikiem
const categories = posts.reduce((acc, post) => {
  const cat = post.data.category;
  acc[cat] = (acc[cat] || 0) + 1;
  return acc;
}, {} as Record<string, number>);

// Format daty
const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('pl-PL', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  }).format(date);
};

// Czas czytania
const getReadingTime = (content: string) => {
  const words = content.split(/\s+/).length;
  return Math.ceil(words / 200);
};

// Slug kategorii
const getCategorySlug = (category: string) => {
  return category.toLowerCase().replace(/\s+/g, '-').replace(/√≥/g, 'o');
};

// Schema.org
const blogSchema = {
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": "Blog Agencja Copywriterska",
  "description": "Praktyczna wiedza o copywritingu, content marketingu, SEO i tworzeniu tre≈õci, kt√≥re sprzedajƒÖ.",
  "url": "https://www.agencja-copywriterska.pl/blog",
  "publisher": {
    "@type": "Organization",
    "name": "Agencja Copywriterska",
    "url": "https://www.agencja-copywriterska.pl",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.agencja-copywriterska.pl/logo.png"
    }
  }
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Strona g≈Ç√≥wna",
      "item": "https://www.agencja-copywriterska.pl"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https://www.agencja-copywriterska.pl/blog"
    }
  ]
};
---

<BaseLayout 
  title="Blog | Agencja Copywriterska - Wiedza o copywritingu i content marketingu"
  description="Praktyczne porady o copywritingu, tworzeniu tre≈õci, SEO i content marketingu. Dowiedz siƒô jak pisaƒá teksty, kt√≥re sprzedajƒÖ."
>
  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />

  <!-- Breadcrumbs -->
  <nav class="breadcrumbs" aria-label="Breadcrumb">
    <div class="container">
      <ol class="breadcrumbs__list">
        <li><a href="/">Strona g≈Ç√≥wna</a></li>
        <li aria-current="page">Blog</li>
      </ol>
    </div>
  </nav>

  <!-- Hero -->
  <section class="blog-hero">
    <div class="container">
      <span class="blog-hero__badge">Blog</span>
      <h1 class="blog-hero__title">
        Wiedza o <span class="accent">copywritingu</span> i content marketingu
      </h1>
      <p class="blog-hero__subtitle">
        Praktyczne porady, case study i sprawdzone strategie tworzenia tre≈õci, kt√≥re sprzedajƒÖ. 
        Dowiedz siƒô, jak pisaƒá skuteczne teksty dla swojego biznesu.
      </p>
    </div>
  </section>

  <!-- Categories Filter -->
  <section class="blog-categories">
    <div class="container">
      <div class="blog-categories__list">
        <a href="/blog" class="blog-categories__item blog-categories__item--active">
          Wszystkie ({posts.length})
        </a>
        {Object.entries(categories).map(([category, count]) => (
          <a 
            href={`/blog/kategoria/${getCategorySlug(category)}`}
            class="blog-categories__item"
          >
            {category} ({count})
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Posts -->
  {featuredPosts.length > 0 && (
    <section class="blog-featured">
      <div class="container">
        <SectionHeading
          label="Wyr√≥≈ºnione"
          title="Polecane <span class='accent'>artyku≈Çy</span>"
          align="left"
        />
        <div class="blog-featured__grid">
          {featuredPosts.map((post, index) => (
            <a 
              href={`/blog/${post.slug}`}
              class={`blog-card blog-card--featured ${index === 0 ? 'blog-card--large' : ''}`}
            >
              {post.data.image ? (
                <div class="blog-card__image">
                  <img 
                    src={post.data.image} 
                    alt={post.data.imageAlt || post.data.title}
                    loading={index === 0 ? "eager" : "lazy"}
                  />
                </div>
              ) : (
                <div class="blog-card__image blog-card__image--placeholder">
                  <span>{post.data.title.substring(0, 2).toUpperCase()}</span>
                </div>
              )}
              <div class="blog-card__content">
                <div class="blog-card__meta">
                  <span class="blog-card__category">{post.data.category}</span>
                  <span class="blog-card__date">{formatDate(post.data.publishDate)}</span>
                </div>
                <h3 class="blog-card__title">{post.data.title}</h3>
                <p class="blog-card__excerpt">{post.data.description}</p>
                <div class="blog-card__footer">
                  <span class="blog-card__reading-time">
                    {getReadingTime(post.body || '')} min czytania
                  </span>
                  <span class="blog-card__arrow">‚Üí</span>
                </div>
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- All Posts -->
  <section class="blog-posts">
    <div class="container">
      <SectionHeading
        label="Artyku≈Çy"
        title="Wszystkie <span class='accent'>wpisy</span>"
        align="left"
      />
      
      {posts.length === 0 ? (
        <div class="blog-posts__empty">
          <div class="blog-posts__empty-icon">üìù</div>
          <h3>Brak artyku≈Ç√≥w</h3>
          <p>Artyku≈Çy pojawiƒÖ siƒô tutaj wkr√≥tce.</p>
        </div>
      ) : (
        <div class="blog-posts__grid">
          {posts.map((post) => (
            <a href={`/blog/${post.slug}`} class="blog-card">
              {post.data.image ? (
                <div class="blog-card__image">
                  <img 
                    src={post.data.image} 
                    alt={post.data.imageAlt || post.data.title}
                    loading="lazy"
                  />
                </div>
              ) : (
                <div class="blog-card__image blog-card__image--placeholder">
                  <span>{post.data.title.substring(0, 2).toUpperCase()}</span>
                </div>
              )}
              <div class="blog-card__content">
                <div class="blog-card__meta">
                  <span class="blog-card__category">{post.data.category}</span>
                  <span class="blog-card__date">{formatDate(post.data.publishDate)}</span>
                </div>
                <h3 class="blog-card__title">{post.data.title}</h3>
                <p class="blog-card__excerpt">{post.data.description}</p>
                <div class="blog-card__footer">
                  <span class="blog-card__reading-time">
                    {getReadingTime(post.body || '')} min czytania
                  </span>
                  <span class="blog-card__arrow">‚Üí</span>
                </div>
              </div>
            </a>
          ))}
        </div>
      )}
    </div>
  </section>

  <!-- CTA -->
  <section class="blog-cta">
    <div class="container">
      <div class="blog-cta__card">
        <h2>Potrzebujesz profesjonalnych tekst√≥w?</h2>
        <p>Skontaktuj siƒô z nami i zam√≥w tre≈õci, kt√≥re przyciƒÖgnƒÖ klient√≥w i zwiƒôkszƒÖ sprzeda≈º.</p>
        <a href="/kontakt" class="btn btn--primary btn--lg">
          Zam√≥w bezp≈ÇatnƒÖ wycenƒô
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Breadcrumbs */
  .breadcrumbs {
    padding: var(--space-4) 0;
    background: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);
  }
  
  .breadcrumbs__list {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: var(--text-sm);
  }
  
  .breadcrumbs__list li {
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }
  
  .breadcrumbs__list li:not(:last-child)::after {
    content: "/";
    color: var(--color-text-tertiary);
  }
  
  .breadcrumbs__list a {
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.2s;
  }
  
  .breadcrumbs__list a:hover {
    color: var(--color-accent);
  }
  
  .breadcrumbs__list li[aria-current="page"] {
    color: var(--color-text-primary);
    font-weight: 500;
  }

  /* Blog Hero */
  .blog-hero {
    padding: var(--space-16) 0 var(--space-12);
    background: var(--color-bg-primary);
    text-align: center;
  }
  
  .blog-hero .container {
    max-width: 800px;
  }
  
  .blog-hero__badge {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    background: var(--color-accent-light);
    color: var(--color-accent-dark);
    font-size: var(--text-sm);
    font-weight: 600;
    border-radius: var(--radius-full);
    margin-bottom: var(--space-6);
  }
  
  .blog-hero__title {
    font-family: var(--font-display);
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 700;
    line-height: 1.2;
    color: var(--color-text-primary);
    margin-bottom: var(--space-6);
  }
  
  .blog-hero__title .accent {
    color: var(--color-accent);
  }
  
  .blog-hero__subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
    line-height: 1.6;
  }

  /* Categories */
  .blog-categories {
    padding: var(--space-8) 0;
    background: var(--color-bg-secondary);
    border-bottom: 1px solid var(--color-border);    
    top: 80px;
    z-index: 50;
  }
  
  .blog-categories__list {
    display: flex;
    gap: var(--space-3);
    flex-wrap: wrap;
    justify-content: center;
  }
  
  .blog-categories__item {
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-full);
    text-decoration: none;
    transition: all 0.2s;
  }
  
  .blog-categories__item:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
  }
  
  .blog-categories__item--active {
    background: var(--color-accent);
    color: var(--color-primary);
    border-color: var(--color-accent);
  }

  /* Featured Posts */
  .blog-featured {
    padding: var(--space-16) 0;
    background: var(--color-bg-primary);
  }
  
  .blog-featured__grid {
    display: grid;
    gap: var(--space-6);
    margin-top: var(--space-10);
  }
  
  @media (min-width: 768px) {
    .blog-featured__grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .blog-featured__grid .blog-card--large {
      grid-column: span 2;
    }
  }
  
  @media (min-width: 1024px) {
    .blog-featured__grid {
      grid-template-columns: 2fr 1fr 1fr;
    }
    
    .blog-featured__grid .blog-card--large {
      grid-column: span 1;
      grid-row: span 2;
    }
  }

  /* Blog Posts Grid */
  .blog-posts {
    padding: var(--space-16) 0;
    background: var(--color-bg-secondary);
  }
  
  .blog-posts__grid {
    display: grid;
    gap: var(--space-6);
    margin-top: var(--space-10);
  }
  
  @media (min-width: 768px) {
    .blog-posts__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  @media (min-width: 1024px) {
    .blog-posts__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .blog-posts__empty {
    text-align: center;
    padding: var(--space-16);
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    margin-top: var(--space-10);
  }
  
  .blog-posts__empty-icon {
    font-size: 3rem;
    margin-bottom: var(--space-4);
  }
  
  .blog-posts__empty h3 {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    font-weight: 600;
    color: var(--color-text-primary);
    margin-bottom: var(--space-2);
  }
  
  .blog-posts__empty p {
    color: var(--color-text-secondary);
  }

  /* Blog Card */
  .blog-card {
    display: flex;
    flex-direction: column;
    background: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    overflow: hidden;
    text-decoration: none;
    transition: all 0.3s ease;
  }
  
  .blog-card:hover {
    border-color: var(--color-accent);
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }
  
  .blog-card__image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--color-bg-secondary);
  }
  
  .blog-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .blog-card:hover .blog-card__image img {
    transform: scale(1.05);
  }
  
  .blog-card__image--placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-accent-light) 0%, var(--color-bg-secondary) 100%);
  }
  
  .blog-card__image--placeholder span {
    font-family: var(--font-display);
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-accent);
    opacity: 0.5;
  }
  
  .blog-card__content {
    padding: var(--space-6);
    display: flex;
    flex-direction: column;
    flex: 1;
  }
  
  .blog-card__meta {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
  }
  
  .blog-card__category {
    font-size: var(--text-xs);
    font-weight: 600;
    color: var(--color-accent);
    background: var(--color-accent-light);
    padding: var(--space-1) var(--space-2);
    border-radius: var(--radius-sm);
  }
  
  .blog-card__date {
    font-size: var(--text-xs);
    color: var(--color-text-tertiary);
  }
  
  .blog-card__title {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: 600;
    color: var(--color-text-primary);
    line-height: 1.3;
    margin-bottom: var(--space-3);
    transition: color 0.2s;
  }
  
  .blog-card:hover .blog-card__title {
    color: var(--color-accent);
  }
  
  .blog-card__excerpt {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: var(--space-4);
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .blog-card__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: var(--space-4);
    border-top: 1px solid var(--color-border);
  }
  
  .blog-card__reading-time {
    font-size: var(--text-sm);
    color: var(--color-text-tertiary);
  }
  
  .blog-card__arrow {
    font-size: var(--text-lg);
    color: var(--color-accent);
    transition: transform 0.2s;
  }
  
  .blog-card:hover .blog-card__arrow {
    transform: translateX(4px);
  }
  
  /* Large card specific styles */
  .blog-card--large .blog-card__image {
    aspect-ratio: auto;
    height: 100%;
    min-height: 200px;
  }
  
  @media (min-width: 1024px) {
    .blog-card--large {
      flex-direction: row;
    }
    
    .blog-card--large .blog-card__image {
      width: 50%;
      aspect-ratio: auto;
    }
    
    .blog-card--large .blog-card__content {
      width: 50%;
      padding: var(--space-8);
    }
    
    .blog-card--large .blog-card__title {
      font-size: var(--text-2xl);
    }
    
    .blog-card--large .blog-card__excerpt {
      -webkit-line-clamp: 4;
    }
  }

  /* CTA */
  .blog-cta {
    padding: var(--space-20) 0;
    background: var(--color-bg-primary);
  }
  
  .blog-cta__card {
    max-width: 700px;
    margin: 0 auto;
    padding: var(--space-12);
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    border-radius: var(--radius-xl);
    text-align: center;
    color: white;
  }
  
  .blog-cta__card h2 {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: 700;
    margin-bottom: var(--space-4);
  }
  
  .blog-cta__card p {
    opacity: 0.9;
    margin-bottom: var(--space-8);
    font-size: var(--text-lg);
  }
  
  .blog-cta__card .btn {
    background: var(--color-accent);
    color: var(--color-primary);
  }
  
  .blog-cta__card .btn:hover {
    background: white;
  }
</style>
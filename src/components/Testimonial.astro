---
interface Props {
  quote: string;
  author: string;
  role?: string;
  company?: string;
  avatar?: string;
  rating?: number;
  class?: string;
}

const { 
  quote, 
  author, 
  role, 
  company, 
  avatar,
  rating = 5,
  class: className = '' 
} = Astro.props;
---

<div class:list={['testimonial', className]}>
  <div class="testimonial__quote-mark">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
      <path d="M11.192 15.757c0-.88-.23-1.618-.69-2.217-.326-.412-.768-.683-1.327-.812-.55-.128-1.07-.137-1.54-.028-.16-.95.1-1.956.76-3.022.66-1.065 1.515-1.867 2.558-2.403L9.373 5c-.8.396-1.56.898-2.26 1.505-.71.607-1.34 1.305-1.9 2.094s-.98 1.68-1.25 2.69-.346 2.04-.217 3.1c.168 1.4.62 2.52 1.356 3.35.735.84 1.652 1.26 2.748 1.26.965 0 1.766-.29 2.4-.878.628-.576.94-1.365.94-2.368l.002.004zm9.124 0c0-.88-.23-1.618-.69-2.217-.326-.42-.77-.692-1.327-.817-.56-.124-1.074-.13-1.54-.022-.16-.94.09-1.95.75-3.02.66-1.06 1.514-1.86 2.557-2.4L18.49 5c-.8.396-1.555.898-2.26 1.505-.708.607-1.34 1.305-1.894 2.094-.556.79-.97 1.68-1.24 2.69-.273 1.01-.345 2.04-.217 3.1.168 1.4.62 2.52 1.356 3.35.735.84 1.652 1.26 2.748 1.26.965 0 1.766-.29 2.4-.878.628-.576.94-1.365.94-2.368l-.007.004z"/>
    </svg>
  </div>

  {rating > 0 && (
    <div class="testimonial__rating">
      {Array.from({ length: 5 }).map((_, i) => (
        <svg 
          class={i < rating ? 'star-filled' : 'star-empty'}
          xmlns="http://www.w3.org/2000/svg" 
          width="18" 
          height="18" 
          viewBox="0 0 24 24" 
          fill={i < rating ? 'currentColor' : 'none'} 
          stroke="currentColor" 
          stroke-width="2"
        >
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
      ))}
    </div>
  )}

  <blockquote class="testimonial__text">
    {quote}
  </blockquote>

  <div class="testimonial__author">
    {avatar ? (
      <img src={avatar} alt={author} class="testimonial__avatar" loading="lazy" />
    ) : (
      <div class="testimonial__avatar testimonial__avatar--placeholder">
        {author.split(' ').map(n => n[0]).join('').slice(0, 2)}
      </div>
    )}
    <div class="testimonial__info">
      <cite class="testimonial__name">{author}</cite>
      {(role || company) && (
        <span class="testimonial__role">
          {role}{role && company && ', '}{company}
        </span>
      )}
    </div>
  </div>
</div>

<style>
  .testimonial {
    position: relative;
    padding: var(--space-8);
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    transition: all var(--transition-base);
  }

  .testimonial:hover {
    border-color: var(--color-accent);
    box-shadow: var(--shadow-lg);
  }

  .testimonial__quote-mark {
    position: absolute;
    top: var(--space-6);
    right: var(--space-6);
    color: var(--color-accent);
    opacity: 0.2;
  }

  .testimonial__rating {
    display: flex;
    gap: var(--space-1);
    margin-bottom: var(--space-4);
  }

  .testimonial__rating svg {
    color: var(--color-accent);
  }

  .testimonial__rating .star-empty {
    opacity: 0.3;
  }

  .testimonial__text {
    font-family: var(--font-display);
    font-size: var(--fs-lg);
    font-weight: var(--fw-medium);
    font-style: italic;
    color: var(--text-primary);
    line-height: var(--lh-relaxed);
    margin-bottom: var(--space-6);
  }

  .testimonial__author {
    display: flex;
    align-items: center;
    gap: var(--space-4);
  }

  .testimonial__avatar {
    width: 48px;
    height: 48px;
    border-radius: var(--radius-full);
    object-fit: cover;
    flex-shrink: 0;
  }

  .testimonial__avatar--placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-primary) 0%, #1a2248 100%);
    color: var(--color-accent);
    font-family: var(--font-display);
    font-weight: var(--fw-semibold);
    font-size: var(--fs-sm);
  }

  .testimonial__info {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }

  .testimonial__name {
    font-family: var(--font-body);
    font-size: var(--fs-base);
    font-weight: var(--fw-semibold);
    font-style: normal;
    color: var(--text-primary);
  }

  .testimonial__role {
    font-size: var(--fs-sm);
    color: var(--text-tertiary);
  }
</style>